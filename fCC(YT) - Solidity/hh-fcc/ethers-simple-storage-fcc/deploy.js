const ethers = require("ethers");
const fs = require("fs-extra");
require("dotenv").config();

async function main() {
  const provider = new ethers.providers.JsonRpcProvider(process.env.RPC_URL);
  const wallet = new ethers.Wallet(process.env.PRIVATE_KEY, provider);
  const abi = fs.readFileSync("./SimpleStorage_sol_SimpleStorage.abi", "utf8");
  const binary = fs.readFileSync(
    "./SimpleStorage_sol_SimpleStorage.bin",
    "utf8"
  );

  const contractFactory = new ethers.ContractFactory(abi, binary, wallet);
  console.log("Deploying contract, please wait...");
  const contract = await contractFactory.deploy();
  const transactionReceipt = await contract.deployTransaction.wait(1);

  // console.log("Deployment Transaction: ");
  // console.log(contract.deployTransaction);

  // console.log("Transaction Receipt: ");
  // console.log(transactionReceipt);

  // Demonstraton of signing a raw transaction
  /*

  console.log("Deploy with only transaction data: ");
  const tx = {
    nonce: 5,
    gasPrice: 20000000000,
    gasLimit: 1000000,
    to: null,
    value: 0,
    data: "0x60806040526040518060400160405280607b81526020016040518060400160405280600581526020017f416c76696e000000000000000000000000000000000000000000000000000000815250815250600160008201518160000155602082015181600101908051906020019061007792919061008c565b50505034801561008657600080fd5b5061018f565b8280546100989061015e565b90600052602060002090601f0160209004810192826100ba5760008555610101565b82601f106100d357805160ff1916838001178555610101565b82800160010185558215610101579182015b828111156101005782518255916020019190600101906100e5565b5b50905061010e9190610112565b5090565b5b8082111561012b576000816000905550600101610113565b5090565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061017657607f821691505b6020821081036101895761018861012f565b5b50919050565b610b3e8061019e6000396000f3fe608060405234801561001057600080fd5b50600436106100935760003560e01c80636693f0c4116100665780636693f0c4146101205780636f760f411461012a57806377ec2b55146101465780639e7a13ad14610165578063dec7e5441461019657610093565b80632e64cec114610098578063471f7cdf146100b65780635c40826c146100d45780636057361d14610104575b600080fd5b6100a06101b2565b6040516100ad91906105fd565b60405180910390f35b6100be6101bb565b6040516100cb91906105fd565b60405180910390f35b6100ee60048036038101906100e99190610772565b6101c1565b6040516100fb91906105fd565b60405180910390f35b61011e600480360381019061011991906107e7565b6101ef565b005b6101286101f9565b005b610144600480360381019061013f9190610874565b61023e565b005b61014e610315565b60405161015c92919061095c565b60405180910390f35b61017f600480360381019061017a91906107e7565b6103af565b60405161018d92919061095c565b60405180910390f35b6101b060048036038101906101ab919061098c565b61046b565b005b60008054905090565b60005481565b6003818051602081018201805184825260208301602085012081835280955050505050506000915090505481565b8060008190555050565b600480548061020b5761020a6109e8565b5b60019003818190600052602060002090600202016000808201600090556001820160006102389190610501565b50509055565b6004604051806040016040528083815260200185858080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f8201169050808301925050505050505081525090806001815401808255809150506001900390600052602060002090600202016000909190919091506000820151816000015560208201518160010190805190602001906102e8929190610541565b50505080600384846040516102fe929190610a47565b908152602001604051809103902081905550505050565b600180600001549080600101805461032c90610a8f565b80601f016020809104026020016040519081016040528092919081815260200182805461035890610a8f565b80156103a55780601f1061037a576101008083540402835291602001916103a5565b820191906000526020600020905b81548152906001019060200180831161038857829003601f168201915b5050505050905082565b600481815481106103bf57600080fd5b90600052602060002090600202016000915090508060000154908060010180546103e890610a8f565b80601f016020809104026020016040519081016040528092919081815260200182805461041490610a8f565b80156104615780601f1061043657610100808354040283529160200191610461565b820191906000526020600020905b81548152906001019060200180831161044457829003601f168201915b5050505050905082565b6000604051806040016040528083815260200184815250905060048190806001815401808255809150506001900390600052602060002090600202016000909190919091506000820151816000015560208201518160010190805190602001906104d6929190610541565b505050816003846040516104ea9190610af1565b908152602001604051809103902081905550505050565b50805461050d90610a8f565b6000825580601f1061051f575061053e565b601f01602090049060005260206000209081019061053d91906105c7565b5b50565b82805461054d90610a8f565b90600052602060002090601f01602090048101928261056f57600085556105b6565b82601f1061058857805160ff19168380011785556105b6565b828001600101855582156105b6579182015b828111156105b557825182559160200191906001019061059a565b5b5090506105c391906105c7565b5090565b5b808211156105e05760008160009055506001016105c8565b5090565b6000819050919050565b6105f7816105e4565b82525050565b600060208201905061061260008301846105ee565b92915050565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61067f82610636565b810181811067ffffffffffffffff8211171561069e5761069d610647565b5b80604052505050565b60006106b1610618565b90506106bd8282610676565b919050565b600067ffffffffffffffff8211156106dd576106dc610647565b5b6106e682610636565b9050602081019050919050565b82818337600083830152505050565b6000610715610710846106c2565b6106a7565b90508281526020810184848401111561073157610730610631565b5b61073c8482856106f3565b509392505050565b600082601f8301126107595761075861062c565b5b8135610769848260208601610702565b91505092915050565b60006020828403121561078857610787610622565b5b600082013567ffffffffffffffff8111156107a6576107a5610627565b5b6107b284828501610744565b91505092915050565b6107c4816105e4565b81146107cf57600080fd5b50565b6000813590506107e1816107bb565b92915050565b6000602082840312156107fd576107fc610622565b5b600061080b848285016107d2565b91505092915050565b600080fd5b600080fd5b60008083601f8401126108345761083361062c565b5b8235905067ffffffffffffffff81111561085157610850610814565b5b60208301915083600182028301111561086d5761086c610819565b5b9250929050565b60008060006040848603121561088d5761088c610622565b5b600084013567ffffffffffffffff8111156108ab576108aa610627565b5b6108b78682870161081e565b935093505060206108ca868287016107d2565b9150509250925092565b600081519050919050565b600082825260208201905092915050565b60005b8381101561090e5780820151818401526020810190506108f3565b8381111561091d576000848401525b50505050565b600061092e826108d4565b61093881856108df565b93506109488185602086016108f0565b61095181610636565b840191505092915050565b600060408201905061097160008301856105ee565b81810360208301526109838184610923565b90509392505050565b600080604083850312156109a3576109a2610622565b5b600083013567ffffffffffffffff8111156109c1576109c0610627565b5b6109cd85828601610744565b92505060206109de858286016107d2565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603160045260246000fd5b600081905092915050565b6000610a2e8385610a17565b9350610a3b8385846106f3565b82840190509392505050565b6000610a54828486610a22565b91508190509392505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680610aa757607f821691505b602082108103610aba57610ab9610a60565b5b50919050565b6000610acb826108d4565b610ad58185610a17565b9350610ae58185602086016108f0565b80840191505092915050565b6000610afd8284610ac0565b91508190509291505056fea2646970667358221220bc43250c5f477d72b7fe46815e5a93ee80c8519061245fff4a3c73ed1e1a37e064736f6c634300080e0033",
    // chainID: 5777,
  };
  const signedTxResponse = await wallet.signTransaction(tx);
  console.log(signedTxResponse);

  */

  // Demonstration of deployong a smart contract via sendTransaction Data
  /*

  const nonce = await wallet.getTransactionCount();
  const tx = {
    nonce: nonce,
    gasPrice: 20000000000,
    gasLimit: 1000000,
    to: null,
    value: 0,
    data: "0x60806040526040518060400160405280607b81526020016040518060400160405280600581526020017f416c76696e000000000000000000000000000000000000000000000000000000815250815250600160008201518160000155602082015181600101908051906020019061007792919061008c565b50505034801561008657600080fd5b5061018f565b8280546100989061015e565b90600052602060002090601f0160209004810192826100ba5760008555610101565b82601f106100d357805160ff1916838001178555610101565b82800160010185558215610101579182015b828111156101005782518255916020019190600101906100e5565b5b50905061010e9190610112565b5090565b5b8082111561012b576000816000905550600101610113565b5090565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061017657607f821691505b6020821081036101895761018861012f565b5b50919050565b610b3e8061019e6000396000f3fe608060405234801561001057600080fd5b50600436106100935760003560e01c80636693f0c4116100665780636693f0c4146101205780636f760f411461012a57806377ec2b55146101465780639e7a13ad14610165578063dec7e5441461019657610093565b80632e64cec114610098578063471f7cdf146100b65780635c40826c146100d45780636057361d14610104575b600080fd5b6100a06101b2565b6040516100ad91906105fd565b60405180910390f35b6100be6101bb565b6040516100cb91906105fd565b60405180910390f35b6100ee60048036038101906100e99190610772565b6101c1565b6040516100fb91906105fd565b60405180910390f35b61011e600480360381019061011991906107e7565b6101ef565b005b6101286101f9565b005b610144600480360381019061013f9190610874565b61023e565b005b61014e610315565b60405161015c92919061095c565b60405180910390f35b61017f600480360381019061017a91906107e7565b6103af565b60405161018d92919061095c565b60405180910390f35b6101b060048036038101906101ab919061098c565b61046b565b005b60008054905090565b60005481565b6003818051602081018201805184825260208301602085012081835280955050505050506000915090505481565b8060008190555050565b600480548061020b5761020a6109e8565b5b60019003818190600052602060002090600202016000808201600090556001820160006102389190610501565b50509055565b6004604051806040016040528083815260200185858080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f8201169050808301925050505050505081525090806001815401808255809150506001900390600052602060002090600202016000909190919091506000820151816000015560208201518160010190805190602001906102e8929190610541565b50505080600384846040516102fe929190610a47565b908152602001604051809103902081905550505050565b600180600001549080600101805461032c90610a8f565b80601f016020809104026020016040519081016040528092919081815260200182805461035890610a8f565b80156103a55780601f1061037a576101008083540402835291602001916103a5565b820191906000526020600020905b81548152906001019060200180831161038857829003601f168201915b5050505050905082565b600481815481106103bf57600080fd5b90600052602060002090600202016000915090508060000154908060010180546103e890610a8f565b80601f016020809104026020016040519081016040528092919081815260200182805461041490610a8f565b80156104615780601f1061043657610100808354040283529160200191610461565b820191906000526020600020905b81548152906001019060200180831161044457829003601f168201915b5050505050905082565b6000604051806040016040528083815260200184815250905060048190806001815401808255809150506001900390600052602060002090600202016000909190919091506000820151816000015560208201518160010190805190602001906104d6929190610541565b505050816003846040516104ea9190610af1565b908152602001604051809103902081905550505050565b50805461050d90610a8f565b6000825580601f1061051f575061053e565b601f01602090049060005260206000209081019061053d91906105c7565b5b50565b82805461054d90610a8f565b90600052602060002090601f01602090048101928261056f57600085556105b6565b82601f1061058857805160ff19168380011785556105b6565b828001600101855582156105b6579182015b828111156105b557825182559160200191906001019061059a565b5b5090506105c391906105c7565b5090565b5b808211156105e05760008160009055506001016105c8565b5090565b6000819050919050565b6105f7816105e4565b82525050565b600060208201905061061260008301846105ee565b92915050565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61067f82610636565b810181811067ffffffffffffffff8211171561069e5761069d610647565b5b80604052505050565b60006106b1610618565b90506106bd8282610676565b919050565b600067ffffffffffffffff8211156106dd576106dc610647565b5b6106e682610636565b9050602081019050919050565b82818337600083830152505050565b6000610715610710846106c2565b6106a7565b90508281526020810184848401111561073157610730610631565b5b61073c8482856106f3565b509392505050565b600082601f8301126107595761075861062c565b5b8135610769848260208601610702565b91505092915050565b60006020828403121561078857610787610622565b5b600082013567ffffffffffffffff8111156107a6576107a5610627565b5b6107b284828501610744565b91505092915050565b6107c4816105e4565b81146107cf57600080fd5b50565b6000813590506107e1816107bb565b92915050565b6000602082840312156107fd576107fc610622565b5b600061080b848285016107d2565b91505092915050565b600080fd5b600080fd5b60008083601f8401126108345761083361062c565b5b8235905067ffffffffffffffff81111561085157610850610814565b5b60208301915083600182028301111561086d5761086c610819565b5b9250929050565b60008060006040848603121561088d5761088c610622565b5b600084013567ffffffffffffffff8111156108ab576108aa610627565b5b6108b78682870161081e565b935093505060206108ca868287016107d2565b9150509250925092565b600081519050919050565b600082825260208201905092915050565b60005b8381101561090e5780820151818401526020810190506108f3565b8381111561091d576000848401525b50505050565b600061092e826108d4565b61093881856108df565b93506109488185602086016108f0565b61095181610636565b840191505092915050565b600060408201905061097160008301856105ee565b81810360208301526109838184610923565b90509392505050565b600080604083850312156109a3576109a2610622565b5b600083013567ffffffffffffffff8111156109c1576109c0610627565b5b6109cd85828601610744565b92505060206109de858286016107d2565b9150509250929050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603160045260246000fd5b600081905092915050565b6000610a2e8385610a17565b9350610a3b8385846106f3565b82840190509392505050565b6000610a54828486610a22565b91508190509392505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b60006002820490506001821680610aa757607f821691505b602082108103610aba57610ab9610a60565b5b50919050565b6000610acb826108d4565b610ad58185610a17565b9350610ae58185602086016108f0565b80840191505092915050565b6000610afd8284610ac0565b91508190509291505056fea2646970667358221220bc43250c5f477d72b7fe46815e5a93ee80c8519061245fff4a3c73ed1e1a37e064736f6c634300080e0033",
    // chainID: 5777,
  };
  const sentTxResponse = await wallet.sendTransaction(5777, tx);
  await sentTxResponse.wait(1);
  console.log(sentTxResponse);

  */

  await contract.store(5201314);
  const currentFavoriteNumber = await contract.retrieve();
  // console.log("Favorite Number is: " + currentFavoriteNumber);
  // console.log(currentFavoriteNumber + "");
  // console.log(currentFavoriteNumber.toString());
  console.log(`Favorite Number is ${currentFavoriteNumber.toString()}`);
  const transactionResponseStore = await contract.store("7"); //Good practice to pass numbers arguement as string
  const transactionReceiptStore = await transactionResponseStore.wait(1);
  const updatedFavoriteNumber = await contract.retrieve();
  console.log(`New Favorite Number is ${updatedFavoriteNumber.toString()}`);
}

main()
  .then(() => process.exit(0))
  .catch((error) => {
    console.error(error);
    process.exit(1);
  });
